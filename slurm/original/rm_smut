#!/bin/bash --login
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --partition=general
#SBATCH --account=a_nefzger
#SBATCH --job-name=rm_smut
#SBATCH --time=24:00:00
#SBATCH --mem=32G
#SBATCH --cpus-per-task=8
#SBATCH --array=1-25
#SBATCH --output=/QRISdata/Q9062/05_smut/log/%A_%a.out
#SBATCH --error=/QRISdata/Q9062/05_smut/log/%A_%a.err

module load bowtie2 2>/dev/null || true

BASE="/QRISdata/Q9062"
SAMPLE=$(sed -n "${SLURM_ARRAY_TASK_ID}p" ${BASE}/01_merged/samples.txt)

R1="${BASE}/03_clean/${SAMPLE}_R1.fastq.gz"
R2="${BASE}/03_clean/${SAMPLE}_R2.fastq.gz"

IDX="${BASE}/05_smut/index/Ssc39B_genome"
OUT="${BASE}/05_smut/clean/${SAMPLE}_R%.fastq.gz"

bowtie2 -x "$IDX" -1 "$R1" -2 "$R2" \
  --very-sensitive -p ${SLURM_CPUS_PER_TASK} \
  --un-conc-gz "$OUT" \
  -S /dev/null \
  2> ${BASE}/05_smut/log/${SAMPLE}.bowtie2.log

